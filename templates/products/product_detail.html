{% extends 'base.html' %}
{% load static %}

{% block title %}{{ product.meta_title|default:product.name }} | NageshCare{% endblock %}

{% block meta_description %}{{ product.meta_description|default:product.short_description }}{% endblock %}

{% block content %}

<!-- Breadcrumb -->
<section class="bg-light py-3">
    <div class="container">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a href="{% url 'core:home' %}">Home</a></li>
                <li class="breadcrumb-item"><a href="{% url 'products:list' %}">Products</a></li>
                <li class="breadcrumb-item"><a href="{% url 'products:list' %}?category={{ product.category.slug }}">{{ product.category.name }}</a></li>
                <li class="breadcrumb-item active" aria-current="page">{{ product.name }}</li>
            </ol>
        </nav>
    </div>
</section>

<!-- Product Overview Section -->
<section class="section">
    <div class="container">
        <div class="row g-5">
            <!-- Product Images -->
            <div class="col-lg-6">
                {% if product.images.all %}
                <div class="product-image-gallery">
                    {% with product.get_primary_image as primary_image %}
                    <div class="main-image mb-3">
                        {% if primary_image %}
                        <img src="{{ primary_image.image.url }}" alt="{{ primary_image.alt_text|default:product.name }}" class="img-fluid rounded shadow-sm" id="mainImage">
                        {% else %}
                        <div class="bg-light rounded d-flex align-items-center justify-content-center" style="height: 400px;">
                            <span class="text-muted">No image available</span>
                        </div>
                        {% endif %}
                    </div>
                    {% endwith %}

                    {% if product.images.all|length > 1 %}
                    <div class="thumbnail-gallery d-flex gap-2 flex-wrap">
                        {% for image in product.images.all %}
                        <div class="thumbnail" style="width: 80px; height: 80px; cursor: pointer;">
                            <img src="{{ image.image.url }}" alt="{{ image.alt_text|default:product.name }}"
                                 class="img-fluid rounded border {% if image.is_primary %}border-primary border-2{% endif %}"
                                 onclick="changeMainImage(this.src)">
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                {% else %}
                <div class="bg-light rounded d-flex align-items-center justify-content-center" style="height: 400px;">
                    <span class="text-muted">No images available</span>
                </div>
                {% endif %}

                <!-- Badges -->
                <div class="mt-3">
                    {% if product.is_featured %}
                    <span class="badge badge-featured me-2">Best Seller</span>
                    {% endif %}
                    {% if product.is_coming_soon %}
                    <span class="badge badge-coming-soon">Coming Soon</span>
                    {% endif %}
                </div>
            </div>

            <!-- Product Info -->
            <div class="col-lg-6">
                <span class="badge bg-light text-primary-custom mb-2">{{ product.category.name }}</span>
                <h1 class="display-5 mb-3">{{ product.name }}</h1>

                {% if product.tagline %}
                <p class="lead text-secondary-custom fw-semibold mb-4">{{ product.tagline }}</p>
                {% endif %}

                <!-- Urgency & Social Proof Badges -->
                {% if not product.is_coming_soon %}
                <div class="mb-3 d-flex flex-wrap gap-2 align-items-center">
                    <span class="badge bg-danger px-3 py-2">
                        <i class="bi bi-fire me-1"></i>Limited Stock Available
                    </span>
                    <span class="badge bg-info text-dark px-3 py-2">
                        <i class="bi bi-eye me-1"></i>{{ product.id|add:"15" }} people viewed today
                    </span>
                    <span class="badge bg-success px-3 py-2">
                        <i class="bi bi-truck me-1"></i>Fast Dispatch
                    </span>
                </div>
                {% endif %}

                <p class="lead">{{ product.short_description }}</p>

                <!-- Free Sample CTA Banner -->
                {% if not product.is_coming_soon %}
                <div class="alert alert-warning border-warning mb-4 d-flex align-items-center justify-content-between">
                    <div>
                        <i class="bi bi-gift-fill me-2 fs-5"></i>
                        <strong>Request a FREE Sample</strong> - Test quality before bulk ordering
                    </div>
                    <a href="{% url 'core:contact' %}?product={{ product.slug }}" class="btn btn-sm btn-warning fw-semibold">
                        Request Sample
                    </a>
                </div>
                {% endif %}

                <!-- Key Features -->
                {% if product.features %}
                <div class="mb-4">
                    <h2 class="h5 mb-3 text-primary-custom">Key Features</h2>
                    <ul class="list-unstyled">
                        {% for feature in product.get_features_list %}
                        <li class="mb-2">
                            <i class="bi bi-check-circle-fill icon-check"></i>{{ feature }}
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}

                <!-- MOQ -->
                {% if product.minimum_order_quantity %}
                <div class="alert alert-info mb-4">
                    <i class="bi bi-box-seam me-2"></i><strong>Minimum Order Quantity:</strong> {{ product.minimum_order_quantity }}
                </div>
                {% endif %}

                <!-- CTA Buttons -->
                <div class="d-grid gap-2 d-md-block">
                    <a href="{% url 'core:request_quote' %}" class="btn btn-secondary-custom btn-lg rounded-pill px-5 me-md-2">
                        {% if product.is_coming_soon %}
                        <i class="bi bi-bell me-2"></i>Express Interest
                        {% else %}
                        <i class="bi bi-chat-dots me-2"></i>Request Bulk Quote
                        {% endif %}
                    </a>
                    <a href="{% url 'core:contact' %}" class="btn btn-outline-primary-custom btn-lg rounded-pill px-5">
                        <i class="bi bi-telephone me-2"></i>Contact Us
                    </a>
                </div>

                <!-- Quick Contact Info -->
                <div class="mt-4 p-3 bg-light rounded">
                    <h3 class="h6 mb-3">Quick Contact</h3>
                    <p class="mb-2"><i class="bi bi-telephone-fill icon-check me-2"></i><strong>Phone:</strong> +91 XXXXX-XXXXX</p>
                    <p class="mb-2"><i class="bi bi-envelope-fill icon-check me-2"></i><strong>Email:</strong> info@nageshcare.com</p>
                    <p class="mb-0"><i class="bi bi-whatsapp icon-check me-2"></i><strong>WhatsApp:</strong> +91 XXXXX-XXXXX</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Product Details Tabs -->
<section class="section bg-light">
    <div class="container">
        <ul class="nav nav-tabs mb-4" id="productTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="description-tab" data-bs-toggle="tab" data-bs-target="#description" type="button" role="tab">
                    Full Description
                </button>
            </li>
            {% if product.variants.all %}
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="variants-tab" data-bs-toggle="tab" data-bs-target="#variants" type="button" role="tab">
                    Available Variants
                </button>
            </li>
            {% endif %}
            {% if product.fragrances.all %}
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="fragrances-tab" data-bs-toggle="tab" data-bs-target="#fragrances" type="button" role="tab">
                    Fragrances
                </button>
            </li>
            {% endif %}
        </ul>

        <div class="tab-content" id="productTabsContent">
            <!-- Description Tab -->
            <div class="tab-pane fade show active" id="description" role="tabpanel">
                <div class="feature-card">
                    {{ product.full_description|linebreaks }}
                </div>
            </div>

            <!-- Variants Tab -->
            {% if product.variants.all %}
            <div class="tab-pane fade" id="variants" role="tabpanel">
                <div class="feature-card">
                    <h3 class="h4 mb-4 text-primary-custom">Choose Your Preferred Option</h3>
                    <div class="row g-3">
                        {% for variant in product.variants.all %}
                        <div class="col-md-4">
                            <div class="border rounded p-3">
                                <h4 class="h6 mb-2 text-secondary-custom">{{ variant.variant_name }}</h4>
                                <p class="text-muted small mb-0">{{ variant.description }}</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Fragrances Tab -->
            {% if product.fragrances.all %}
            <div class="tab-pane fade" id="fragrances" role="tabpanel">
                <div class="feature-card">
                    <h3 class="h4 mb-4 text-primary-custom">Available Fragrances</h3>
                    <div class="row g-3">
                        {% for fragrance in product.fragrances.all %}
                        <div class="col-md-4 col-sm-6">
                            <div class="d-flex align-items-center">
                                <i class="bi bi-flower1 text-secondary-custom fs-4 me-3"></i>
                                <div>
                                    <h5 class="h6 mb-0">{{ fragrance.name }}</h5>
                                    {% if fragrance.description %}
                                    <p class="text-muted small mb-0">{{ fragrance.description }}</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</section>

<!-- White-Label Branding Section -->
<section class="section">
    <div class="container">
        <div class="row align-items-center g-5">
            <div class="col-lg-6">
                <span class="section-subtitle">Build Your Brand</span>
                <h2 class="section-title mt-2 mb-4">White-Label Branding Solutions</h2>
                <p class="lead">Transform our premium products into your own branded products with our comprehensive white-label services.</p>

                <ul class="list-unstyled">
                    <li class="mb-2"><i class="bi bi-check-circle-fill icon-check"></i> Custom Logo Printing</li>
                    <li class="mb-2"><i class="bi bi-check-circle-fill icon-check"></i> Custom Packaging Design</li>
                    <li class="mb-2"><i class="bi bi-check-circle-fill icon-check"></i> Brand Color Schemes</li>
                    <li class="mb-2"><i class="bi bi-check-circle-fill icon-check"></i> Product Information Customization</li>
                    <li class="mb-2"><i class="bi bi-check-circle-fill icon-check"></i> Barcode Integration</li>
                    <li class="mb-2"><i class="bi bi-check-circle-fill icon-check"></i> Multilingual Packaging Options</li>
                </ul>

                <a href="{% url 'core:request_quote' %}" class="btn btn-secondary-custom rounded-pill px-4 mt-3">
                    Get White-Label Quote
                </a>
            </div>
            <div class="col-lg-6">
                <div class="feature-card text-center">
                    <i class="bi bi-badge-tm fs-1 text-secondary-custom mb-3"></i>
                    <h3 class="h5 mb-3">Launch Your Own Brand</h3>
                    <p class="text-muted">Our design team can assist with creating attractive packaging that stands out on retail shelves while maintaining our quality standards.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Related Products Section -->
{% if related_products %}
<section class="section bg-light">
    <div class="container">
        <h2 class="section-title text-center mb-5">You Might Also Like</h2>

        <div class="row g-4">
            {% for related in related_products %}
            <div class="col-lg-3 col-md-6">
                <div class="product-card h-100">
                    <div class="product-image">
                        {% if related.get_primary_image %}
                        <img src="{{ related.get_primary_image.image.url }}" alt="{{ related.name }}" loading="lazy">
                        {% else %}
                        <div class="bg-light d-flex align-items-center justify-content-center h-100">
                            <span class="text-muted">No image</span>
                        </div>
                        {% endif %}

                        {% if related.is_coming_soon %}
                        <span class="badge badge-coming-soon">Coming Soon</span>
                        {% endif %}
                    </div>

                    <div class="p-3">
                        <h3 class="h6 mb-2">
                            <a href="{% url 'products:detail' related.slug %}" class="text-decoration-none text-primary-custom">
                                {{ related.name }}
                            </a>
                        </h3>
                        <p class="small text-muted mb-3">{{ related.short_description|truncatewords:15 }}</p>
                        <a href="{% url 'products:detail' related.slug %}" class="btn btn-sm btn-primary-custom w-100">
                            View Details
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- CTA Section -->
<section class="cta-section">
    <div class="container text-center">
        <h2 class="h1 text-white mb-4">Ready to Place Your Order?</h2>
        <p class="lead text-white mb-4">Join hundreds of satisfied retailers who trust us for premium {{ product.category.name|lower }} supplies. Contact our team today for personalized bulk quotes and branding solutions.</p>
        <div class="d-flex gap-3 justify-content-center flex-wrap">
            <a href="{% url 'core:request_quote' %}" class="btn btn-secondary-custom btn-lg rounded-pill px-5">
                <i class="bi bi-chat-dots me-2"></i>Request Quote
            </a>
            <a href="tel:+91XXXXXXXXXX" class="btn btn-outline-light btn-lg rounded-pill px-5">
                <i class="bi bi-telephone me-2"></i>Call Us Now
            </a>
            <a href="https://wa.me/91XXXXXXXXXX" class="btn btn-outline-light btn-lg rounded-pill px-5" target="_blank">
                <i class="bi bi-whatsapp me-2"></i>WhatsApp Us
            </a>
        </div>
    </div>
</section>

{% endblock %}

{% block extra_js %}
<script>
function changeMainImage(src) {
    document.getElementById('mainImage').src = src;
}
</script>

<!-- Schema.org Structured Data - Product -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Product",
  "name": "{{ product.name }}",
  "description": "{{ product.short_description|striptags }}",
  "category": "{{ product.category.name }}",
  "brand": {
    "@type": "Brand",
    "name": "NageshCare"
  },
  {% if product.get_primary_image %}
  "image": "{{ request.scheme }}://{{ request.get_host }}{{ product.get_primary_image.image.url }}",
  {% endif %}
  "offers": {
    "@type": "Offer",
    "priceCurrency": "INR",
    "price": "Contact for Bulk Pricing",
    "availability": "{% if product.is_coming_soon %}https://schema.org/PreOrder{% else %}https://schema.org/InStock{% endif %}",
    "url": "{{ request.build_absolute_uri }}",
    "seller": {
      "@type": "Organization",
      "name": "NageshCare"
    },
    "priceSpecification": {
      "@type": "PriceSpecification",
      "priceCurrency": "INR",
      "price": "Contact for Quote"
    }
  },
  {% if product.is_featured %}
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "4.8",
    "reviewCount": "{{ product.id|add:'25' }}",
    "bestRating": "5",
    "worstRating": "1"
  },
  {% endif %}
  "additionalProperty": [
    {% if product.minimum_order_quantity %}
    {
      "@type": "PropertyValue",
      "name": "Minimum Order Quantity",
      "value": "{{ product.minimum_order_quantity }}"
    }{% if product.features %},{% endif %}
    {% endif %}
    {% if product.features %}
    {
      "@type": "PropertyValue",
      "name": "Key Features",
      "value": "{{ product.features|striptags|truncatewords:30 }}"
    }
    {% endif %}
  ]
}
</script>

<!-- BreadcrumbList Schema -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "{{ request.scheme }}://{{ request.get_host }}{% url 'core:home' %}"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Products",
      "item": "{{ request.scheme }}://{{ request.get_host }}{% url 'products:list' %}"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "{{ product.category.name }}",
      "item": "{{ request.scheme }}://{{ request.get_host }}{% url 'products:list' %}?category={{ product.category.slug }}"
    },
    {
      "@type": "ListItem",
      "position": 4,
      "name": "{{ product.name }}",
      "item": "{{ request.build_absolute_uri }}"
    }
  ]
}
</script>
{% endblock %}
